version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        # Amplify 환경변수를 .env 파일로 생성 (Next.js 빌드 시 사용)
        - echo "Creating .env file from Amplify environment variables..."
        - |
          if [ -n "$NEXT_PUBLIC_NAVER_MAP_CLIENT_ID" ]; then
            echo "NEXT_PUBLIC_NAVER_MAP_CLIENT_ID=$NEXT_PUBLIC_NAVER_MAP_CLIENT_ID" >> .env
          fi
        - |
          if [ -n "$OPENAI_API_KEY" ]; then
            echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env
          fi
        - |
          if [ -n "$GROK_API_KEY" ]; then
            echo "GROK_API_KEY=$GROK_API_KEY" >> .env
          fi
        - |
          if [ -n "$KOREA_TOURISM_API_KEY" ]; then
            echo "KOREA_TOURISM_API_KEY=$KOREA_TOURISM_API_KEY" >> .env
          fi
        - |
          if [ -n "$LLM_PROVIDER" ]; then
            echo "LLM_PROVIDER=$LLM_PROVIDER" >> .env
          fi
        - |
          if [ -n "$LLM_MODEL" ]; then
            echo "LLM_MODEL=$LLM_MODEL" >> .env
          fi
        - |
          if [ -n "$LLM_TEMPERATURE" ]; then
            echo "LLM_TEMPERATURE=$LLM_TEMPERATURE" >> .env
          fi
        - |
          if [ -n "$LLM_MAX_TOKENS" ]; then
            echo "LLM_MAX_TOKENS=$LLM_MAX_TOKENS" >> .env
          fi
        # 환경변수 확인 (디버깅용)
        - echo "Environment variables check:"
        - |
          if [ -f .env ]; then
            echo ".env file created successfully"
            echo "Number of environment variables: $(wc -l < .env)"
          else
            echo "WARNING: .env file was not created"
          fi
    build:
      commands:
        # Next.js 빌드 (환경변수는 .env 파일과 process.env에서 자동으로 읽힘)
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
